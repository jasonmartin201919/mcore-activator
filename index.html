<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MCORE 授权中心</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --bg: #0f172a; --accent: #4f46e5; --text: #f8fafc; }
        /* 暗金色管理模式变量 */
        .admin-mode { --bg: #1a150e; --accent: #d4af37; --text: #fef3c7; }
        
        body { background-color: var(--bg); color: var(--text); transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .admin-mode .glass { background: rgba(45, 38, 25, 0.6); border: 1px solid rgba(212, 175, 55, 0.2); box-shadow: 0 0 40px rgba(0,0,0,0.6); }
        
        .gold-btn { background: linear-gradient(45deg, #d4af37, #b8860b); color: #1a150e; }
        .gold-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .gold-btn:active { transform: translateY(1px); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-show { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 font-sans antialiased">

<div id="mainContainer" class="glass p-8 md:p-12 rounded-[2.5rem] w-full max-w-md transition-all duration-700">
    <div class="text-center mb-10">
        <h1 id="brandTitle" class="text-3xl font-black italic tracking-tighter transition-colors duration-500">MCORE <span class="opacity-50 text-sm not-italic font-light ml-1">2.5</span></h1>
        <p id="subTitle" class="text-gray-500 text-[10px] uppercase tracking-[0.3em] mt-2">Authorization System</p>
    </div>

    <div class="space-y-6">
        <div class="relative">
            <input type="text" id="orderId" oninput="handleInput(this.value)" placeholder="输入核验单号" 
                class="w-full bg-black/30 border border-white/5 rounded-2xl px-6 py-4 focus:outline-none text-center font-mono text-lg transition-all placeholder:text-gray-700">
        </div>
        
        <div id="normalBox" class="block">
            <button onclick="processNormal()" class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl font-bold tracking-widest transition-all shadow-xl shadow-indigo-900/20">
                开始安全核验
            </button>
        </div>

        <div id="adminBox" class="hidden grid grid-cols-2 gap-4 animate-show">
            <button onclick="processSuper()" class="gold-btn py-4 rounded-2xl font-black text-xs uppercase tracking-widest shadow-lg shadow-yellow-900/20">
                提取激活码
            </button>
            <button onclick="gotoBackend()" class="bg-white/5 border border-white/10 hover:bg-white/10 py-4 rounded-2xl font-bold text-xs uppercase tracking-widest">
                管理后台
            </button>
        </div>

        <div id="resultArea" class="hidden animate-show mt-8 p-6 bg-black/40 rounded-3xl border border-white/5 border-dashed">
            <p class="text-[10px] text-gray-500 text-center uppercase tracking-widest mb-3">Verified Activation Key</p>
            <div id="keyCode" class="text-xl font-mono font-bold text-center break-all select-all tracking-wider text-indigo-400">
                MCORE-XXXX-XXXX
            </div>
            <div id="statusTag" class="mt-4 text-[9px] text-center opacity-40 italic">数据已于云端同步</div>
        </div>
    </div>
</div>

<script>
    const SUPER_KEY = "940715";

    // 监听输入，实时切换暗金模式
    function handleInput(val) {
        const isSuper = val.trim() === SUPER_KEY;
        const body = document.body;
        const normalBox = document.getElementById('normalBox');
        const adminBox = document.getElementById('adminBox');
        const brand = document.getElementById('brandTitle');

        if (isSuper) {
            body.classList.add('admin-mode');
            normalBox.classList.add('hidden');
            adminBox.classList.remove('hidden');
            brand.classList.add('text-[#d4af37]');
            // 隐藏之前可能显示的结果
            document.getElementById('resultArea').classList.add('hidden');
        } else {
            body.classList.remove('admin-mode');
            normalBox.classList.remove('hidden');
            adminBox.classList.add('hidden');
            brand.classList.remove('text-[#d4af37]');
        }
    }

    // 超级码提取逻辑：生成普通格式的激活码
    function processSuper() {
        // 生成普通格式 MCORE-XXXX-XXXX
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        const gen = (len) => Array.from({length: len}, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
        const fakeKey = `MCORE-${gen(4)}-${gen(4)}`;
        
        showResult(fakeKey, "text-[#d4af37]");
    }

    // 普通订单核验逻辑
    async function processNormal() {
        const id = document.getElementById('orderId').value.trim();
        if(id.length < 4) return alert("请输入正确单号");
        
        try {
            const res = await fetch(`pool.json?t=${Date.now()}`);
            const data = await res.json();
            const pool = data.pool || [];
            
            // 映射逻辑
            let hash = 0; for (let i = 0; i < id.length; i++) { hash = ((hash << 5) - hash) + id.charCodeAt(i); }
            const keyData = pool[Math.abs(hash) % pool.length];
            
            showResult(keyData.code, "text-indigo-400");
        } catch (e) {
            alert("同步失败，请检查网络");
        }
    }

    function showResult(code, colorClass) {
        const resArea = document.getElementById('resultArea');
        const keyDisplay = document.getElementById('keyCode');
        keyDisplay.innerText = code;
        keyDisplay.className = `text-xl font-mono font-bold text-center break-all select-all tracking-wider ${colorClass}`;
        resArea.classList.remove('hidden');
    }

    function gotoBackend() {
        // 跳转至私有仓库中的 admin.html
        window.location.href = "admin.html";
    }
</script>
</body>
</html>
